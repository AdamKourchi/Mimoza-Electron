<!DOCTYPE html>
<html lang="fr">

<head>
    <meta charset="UTF-8" />
    <title>Mimoza</title>
    <link rel="stylesheet" href="public/tab/dist/css/tabulator_simple.css" />
    <link href="public/bootstrap/dist/css/bootstrap.css" rel="stylesheet" />
    <link rel="stylesheet" href="assets/fontawesome/css/all.min.css" />
    <link rel="stylesheet" href="assets/style.css" />


</head>


<body class="bg-body-secondary">
    <nav
    class="navbar navbar-expand-sm bg-dark sticky-top"
    data-bs-theme="dark"
  >
    <div class="container-fluid">
      <button
        class="navbar-toggler"
        type="button"
        data-bs-toggle="collapse"
        data-bs-target="#navbarTogglerDemo03"
        aria-controls="navbarTogglerDemo03"
        aria-expanded="false"
        aria-label="Toggle navigation"
      >
        <span class="navbar-toggl/e/r-ic/o/n">placeholder</span>
      </button>
      <a class="navbar-brand" href="#"
        ><img
          src="./assets/logo.svg"
          width="100px"
          class="d-none d-xl-block"
        />
      </a>
      <div class="collapse navbar-collapse" id="navbarTogglerDemo03">
        <ul class="navbar-nav me-auto mb-2 mb-lg-0">
          <li class="nav-item d-flex align-items-center">
            <a class="nav-link" aria-current="page" href="index.html"
              ><i class="fa-solid fa-calendar" style="color: #ffffff"></i>
              Reservations |
            </a>
          </li>
          <li class="nav-item d-flex align-items-center">
            <a class="nav-link" href="charges.html"
              ><i
                class="fa-solid fa-comment-dollar"
                style="color: #ffffff"
              ></i>
              Charges |
            </a>
          </li>
          <li class="nav-item d-flex align-items-center">
            <a class="nav-link" href="credits.html">
              <i class="fa-solid fa-coins" style="color: #ffffff"></i>

              Crédits |
            </a>
          </li>
          <li class="nav-item d-flex align-items-center">
            <a class="nav-link active" href="#">
              <i
                class="fa-solid fa-hand-holding-dollar"
                style="color: #ffffff"
              ></i>
              Avances |
            </a>
          </li>
          <li class="nav-item d-flex align-items-center">
            <a class="nav-link" href="cars.html">
              <i class="fa-solid fa-car-side" style="color: #ffffff"></i>
              Park |
            </a>
          </li>
          <li class="nav-item d-flex align-items-center">
            <a class="nav-link" href="clients.html">
              <i class="fa-solid fa-person" style="color: #ffffff"></i>
              Clients |
            </a>
          </li>
        </ul>
        <span class="text-white" id="navbarList"></span>
        <a href="infos.html"><i class="fa-solid fa-circle-info mx-2" style="color: #ffffff"></i></a>
      </div>
    </div>
  </nav>

    <div class="px-4">
        <h1 class="mt-4">Avances :</h1>
    </div>
    <hr />
    <div id="table" class="container-fluid"></div>

    <div class="container-fluid  d-flex justify-content-end mt-2 mb-5">
        <button id="addRow" class="btn btn-outline-success">+ Ajouter</button>
    </div>



    <script src="public/jquery/dist/jquery.js"></script>
    <script src="public/popper.js"></script>
    <script src="public/bootstrap/dist/js/bootstrap.js"></script>
    <script src="public/luxon.js"></script>
    <script src="public/tab/dist/js/tabulator.js"></script>
    <script>
        document.addEventListener("DOMContentLoaded", function () {
            let avances = window.api.getAvances();
            console.log(avances);

            document.getElementById('addRow').addEventListener('click', function () {
                table.addRow({
                    Date:'',Versement:'',Type:'',Montant:'',

                });
            });

            // Tabulator
            let types = ['VERSEMENT', 'ESPECE'];

            var columns = [{
                title: "Date",
                field: "date_avance",
                sorter: "number",
                editor: "date",
            },
            {
                title: "Versement",
                field: "observation",
                sorter: "string",
                editor: "input"
            },
            {
    title: "Type",
    field: "type_avance ",
    editor: "list",
    editorParams: {
        values: types
    },
    cellClick: function(e, cell) {
        if (cell.getValue() === 'VERSEMENT') {
            cell.getElement().style.backgroundColor = 'red';
        } else {
            cell.getElement().style.backgroundColor = 'yellow';
        }
    }
},
            
            {
                title: "Montant",
                field: "montant",
                sorter: "number",
                editor: "input",
                bottomCalc: "sum",
                bottomCalcParams: {
                    precision: 2,
                }
            }
            ];
            // Delete row function
            var rowMenu = [
                {
                    label: "<i class='fas fa-trash'></i> Delete Row",
                    action: function (e, row) {
                        row.delete();
                    },
                },
            ];
            

            var table = new Tabulator("#table", {
                data: avances,
                index: "id",
                columns: columns,
                layout: "fitColumns",
                responsiveLayout: "hide",
                tooltips: true,
                addRowPos: "bottom",
                history: true,
                virtualDom: true,
                height: "213px",
                rowContextMenu: rowMenu,
            });
            table.on("rowAdded", async function (row) {
          try {
            const response = await window.api.storeAvances();
            console.log(response);
            row.update({ id: response });
          } catch (error) {
            console.error("Error storing avances:", error);
          }
        });
        table.on("cellEdited", async function (cell) {
          console.log("cell edited");
          console.log(cell.getRow().getData().id);
          let updatedData = {
            [cell.getField()]: cell.getValue(),
          };
          console.log(updatedData);
          try {
            const response = await window.api.updateAvances(
              cell.getRow().getData().id,
              cell.getField(),
              cell.getValue()
            );
            console.log(response);
          } catch (error) {
            console.error("Error updating cars:", error);
          }
        });
        table.on("rowDeleted", async function (row) {
          try {
            console.log(row.getData().id);
            const response = await window.api.deleteAvances(row.getData().id); // Call the storeReservations function from the preload script
            console.log(response);
          } catch (error) {
            console.error("Error deleting avances:", error);
          }
        });


        //Islamic Duaa
        const strings = [
          "اللهم اهدنا",
          "اللهم اغفر لي",
          "رب اغفر وارحم",
          "رب اشرح لي صدري",
          "ربنا آتنا في الدنيا حسنة",
          "رب اغفر لي وارحمني",
          "اللهم إني أعوذ بك من العجز والكسل",
          "اللهم اجعل لساني عامرا بذكرك",
          "ربنا لا تزغ قلوبنا",
        ];

        function updateNavbar() {
          const navbarList = document.getElementById("navbarList");
          navbarList.innerHTML = "";
          const randomString =
            strings[Math.floor(Math.random() * strings.length)];

          navbarList.textContent = randomString;
        }

        updateNavbar();

        // Update navbar content every 10 minutes
        setInterval(updateNavbar, 5 * 60 * 1000);
      
        });

    </script>
</body>

</html>